<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Configuration - MicroTBX-Modbus User Manual</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Configuration";
        var mkdocs_page_input_path = "configuration.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> MicroTBX-Modbus User Manual
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../gettingstarted/">Getting started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../licensing/">Dual licensing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../misra/">MISRA compliance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../integration/">Integration</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Configuration</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#heap-size">Heap size</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#15-character-timeout-detection">1.5 character timeout detection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#event-queue-size">Event queue size</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../portation/">Portation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../extras/">Extras</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../apiref/">API reference</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">MicroTBX-Modbus User Manual</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Configuration</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/feaser/microtbx-modbus/edit/master/docs/configuration.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="configuration">Configuration</h1>
<p>MicroTBX-Modbus was designed with ease of integration, portation and use in mind. As such, the default configuration works right out-of-the-box for the majority of use cases. In the rare situation that something doesn't work right, a few configuration macros exists to reconfigure the software component to your needs.</p>
<p>To change a value of a configuration macro, add the macro with the new value to the MicroTBX configuration header file <code>tbx_conf.h</code> in your application.</p>
<h2 id="heap-size">Heap size</h2>
<p>The most likely problem is that the MicroTBX heap size is configured too small. You typically notice this during initialization, when creating a channel object (e.g. <code>TbxMbServerCreate()</code>) or transport layer object (e.g. <code>TbxMbRtuCreate()</code>). The return value will be invalid and, if enabled, an assertion error is triggered. </p>
<p>If this happens, increase the maximum heap size with macro <code>TBX_CONF_HEAP_SIZE</code>:</p>
<pre><code class="language-c">/* Configure the size of the heap in bytes. */
#define TBX_CONF_HEAP_SIZE                       (4096U)
</code></pre>
<p>Usually when you hear that a software component uses the heap, alarm bells start going off. The general consensus is that one should not use the heap and only do static memory allocations. This is to prevent RAM memory fragmentation issues, possibly leading to an out-of-memory problem. </p>
<p>However, MicroTBX-Modbus uses its own memory pools for dynamic allocation in a preallocated static RAM buffer that MicroTBX refers to as the heap. Its memory pool usage is such that there is no risk for memory fragmentation or out-of-memory problems. In fact, that's the entire idea behind the <a href="https://feaser.github.io/microtbx/mempools/">memory pools</a> offered by MicroTBX: It enables you to do dynamic memory allocation on an embedded system in a safe manner, where it would otherwise not be possible or advisable.</p>
<h2 id="15-character-timeout-detection">1.5 character timeout detection</h2>
<p>The Modbus RTU protocol requires that all bytes of a communication packet are communicated as a consecutive and uninterrupted data stream. The time between two bytes cannot be more than the time it would take to send 1.5 bytes (characters). The receiver of a Modbus RTU packet needs to continuously check for this 1.5 character timeout. When the received detect such a timeout, it should flag the Modbus RTU packet as invalid and not process it any further.</p>
<p>As opposed to most other available Modbus software stacks, MicroTBX-Modbus actually fully supports this 1.5 character timeout detection, when receiving Modbus RTU packets. However, it disables this feature by default for the following reasons: </p>
<ul>
<li>Some Modbus RTU devices on the market do not adhere to this requirement.</li>
<li>PCs, embedded Linux devices, and USB-RS232/RS485 adapters cannot always meet this requirement.</li>
</ul>
<p>In case you know that all devices on your Modbus RTU network adhere to this requirements or you need to pass Modbus compliance testing, you can enable the 1.5 character timeout detection with the help of macro <code>TBX_MB_RTU_T1_5_TIMEOUT_ENABLE</code>:</p>
<pre><code class="language-c">/* Enable the Modbus RTU 1.5 character timeout detection. */
#define TBX_MB_RTU_T1_5_TIMEOUT_ENABLE           (1U)
</code></pre>
<h2 id="event-queue-size">Event queue size</h2>
<p>To keep interrupt latency times as low as possible, MicroTBX-Modbus does as much processing as possible in its event task <code>TbxMbEventTask()</code> and not at interrupt level. Internally, events are posted to an event queue and they are consumed by the event task. At a given point in time the event queue can hold a (finite) amount of pending events. The macro <code>TBX_MB_EVENT_QUEUE_SIZE</code> configures its size. </p>
<p>Only one scenario exists,where you would want to change the value of this macro: On a RAM constrained microcontroller, where you run out of RAM. In this case you want to set the event queue size as small as possible. This is basically 4 times (<code>TBX_MB_EVENT_NUM_ID</code>) the number of Modbus server and client channels that you create in your application:</p>
<pre><code class="language-c">/* Configure the internal event queue size. Set it to 4 times the number of used
 * Modbus server and client channels that your application creates.
 */
#define TBX_MB_EVENT_QUEUE_SIZE                 (4U * 1U)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../integration/" class="btn btn-neutral float-left" title="Integration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../portation/" class="btn btn-neutral float-right" title="Portation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/feaser/microtbx-modbus" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../integration/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../portation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
